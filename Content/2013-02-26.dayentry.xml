<?xml version="1.0" encoding="utf-8"?>
<DayEntry xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="urn:newtelligence-com:dasblog:runtime:data">
  <Date>2013-02-25T19:00:00-05:00</Date>
  <Entries>
    <Entry>
      <Content>&lt;p&gt;This helped hugely when testing over 2 contexts – an Enterprise Library direct call to SP, and Entitiy Framework call using RIA:&lt;/p&gt;  &lt;p&gt;Base class for tests:&lt;/p&gt;  &lt;div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:12efa3e7-a2a8-4edc-9ceb-527bed10ec01" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"&gt; &lt;div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt"&gt; &lt;div style="background-color: #ffffff; overflow: auto; padding: 2px 5px; white-space: nowrap"&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; [&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#4ec9b0"&gt;TestClass&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;]&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;    &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;public&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;class&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#4ec9b0"&gt;TransactedTestBasex&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;    {&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;        &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;protected&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ff3333"&gt;xxxClientAppUserEntitlementReviewEntities&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ffffff"&gt;xxxEntities&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;;&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;        &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;protected&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ff3333"&gt;FakexxxUserProvider&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ffffff"&gt;fakeUserProvider&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;;&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;        &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;protected&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ff3333"&gt;xxxClientAppDomainService&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ffffff"&gt;xxxDomainService&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;;&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;        &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#608b4e"&gt;//private TestDbTransaction _transaction;&lt;/span&gt;&lt;br&gt; &lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;        &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;private&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#4ec9b0"&gt;TransactionScope&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ffffff"&gt;scope&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;;&lt;/span&gt;&lt;br&gt; &lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;        [&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#4ec9b0"&gt;TestInitialize&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;()]&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;        &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;public&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;void&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ffffff"&gt;TestStart&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;()&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;        {&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;            &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;if&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; (&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ffffff"&gt;xxxDomainService&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#b4b4b4"&gt;==&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;null&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;)&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;            {&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;                &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;throw&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;new&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#4ec9b0"&gt;NullReferenceException&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;(&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#d69d85"&gt;&amp;quot;Please ensure that you initialise xxxDomainService in the constructor of derived test class.&amp;quot;&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;);&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;            }&lt;/span&gt;&lt;br&gt; &lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;            &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ffffff"&gt;scope&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#b4b4b4"&gt;=&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;new&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#4ec9b0"&gt;TransactionScope&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;(&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#b8d7a3"&gt;TransactionScopeOption&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#b4b4b4"&gt;.&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ffffff"&gt;RequiresNew&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;);&lt;/span&gt;&lt;br&gt; &lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;            &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#608b4e"&gt;//_transaction = xxxDomainService.BeginTransactionForUnitTest();&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;        }&lt;/span&gt;&lt;br&gt; &lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;        [&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#4ec9b0"&gt;TestCleanup&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;()]&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;        &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;public&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;void&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ffffff"&gt;TestEnd&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;()&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;        {&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;            &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#608b4e"&gt;//_transaction.RollbackUnitTest();&lt;/span&gt;&lt;br&gt; &lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;            &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;if&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; (&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ffffff"&gt;scope&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#b4b4b4"&gt;!=&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt; &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#569cd6"&gt;null&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;)&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;            {&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;                &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#608b4e"&gt;// NOTE: no call to scope.Complete();&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;                &lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ffffff"&gt;scope&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#b4b4b4"&gt;.&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#ffffff"&gt;Dispose&lt;/span&gt;&lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;();&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;            }&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;        }&lt;/span&gt;&lt;br&gt; &lt;span style="background:#1e1e1e;color:#dcdcdc"&gt;    }&lt;/span&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt;  &lt;p&gt;&lt;a href="http://www.programgood.net/content/binary/Windows-Live-Writer/f31a596b00b6_8994/image_2.png"&gt;&lt;img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://www.programgood.net/content/binary/Windows-Live-Writer/f31a596b00b6_8994/image_thumb.png" width="421" height="164" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;MSDTC is unavailable&lt;/p&gt;  &lt;p&gt;1) check Distributed Transaction Coordinator in services is running.&lt;/p&gt;</Content>
      <Created>2013-02-26T05:02:47.0899763-05:00</Created>
      <Modified>2013-02-26T05:02:47.0899763-05:00</Modified>
      <EntryId>7663a730-1d2e-43eb-8692-ac1a7e8463ff</EntryId>
      <Description />
      <Title>Transaction Scope testing</Title>
      <Categories>Entity Framework;Testing</Categories>
      <Author>admin</Author>
      <IsPublic>true</IsPublic>
      <Syndicated>true</Syndicated>
      <ShowOnFrontPage>true</ShowOnFrontPage>
      <AllowComments>true</AllowComments>
      <Attachments />
      <Crossposts />
      <Latitude xsi:nil="true" />
      <Longitude xsi:nil="true" />
    </Entry>
  </Entries>
</DayEntry>