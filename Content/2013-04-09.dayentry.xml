<?xml version="1.0" encoding="utf-8"?>
<DayEntry xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="urn:newtelligence-com:dasblog:runtime:data">
  <Date>2013-04-08T20:00:00-04:00</Date>
  <Entries>
    <Entry>
      <Content>&lt;p&gt;Am figuring out an issue where I want:&lt;/p&gt;  &lt;p&gt;“Find GALs where there are multiple corresponding RIs, however not where the RI.ReviewID is different”&lt;/p&gt;  &lt;p&gt;Using Linqpad like a simple scratchpad is very useful:&lt;/p&gt;  &lt;p&gt;Especially if run out of memory, can commit each transaction on the fly:&lt;/p&gt;  &lt;div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:1141ccc0-d19d-4c84-8851-96c940f8299b" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"&gt; &lt;div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt"&gt; &lt;div style="background-color: #ffffff; overflow: auto; padding: 2px 5px; white-space: nowrap"&gt;&lt;span style="color:#008000"&gt;// get all GroupAccountLinks which have &amp;gt; 1 review item - this is normally as they are in multiple reviews (applicaitons)&lt;/span&gt;&lt;br&gt; &lt;span style="color:#0000ff"&gt;var&lt;/span&gt;&lt;span style="color:#000000"&gt; galMulti = GroupAccountLinks.Where(gal =&amp;gt; gal.ReviewItems.Count() &amp;gt; &lt;/span&gt;&lt;span style="color:#c81efa"&gt;1&lt;/span&gt;&lt;span style="color:#000000"&gt;).ToList();&lt;/span&gt;&lt;br&gt; &lt;span style="color:#008000"&gt;//var galMulti = GroupAccountLinks.Where(gal =&amp;gt; gal.ReviewItems.Count() &amp;gt; 1 &amp;amp;&amp;amp; gal.GroupID == 3103); // lim test&lt;/span&gt;&lt;br&gt; &lt;span style="color:#008000"&gt;// 415,311 records&lt;/span&gt;&lt;br&gt; &lt;span style="color:#008000"&gt;//var list = new List&amp;lt;string&amp;gt;();&lt;/span&gt;&lt;br&gt; &lt;span style="color:#008000"&gt;//var listOfRIToDelete = new List&amp;lt;long&amp;gt;();&lt;/span&gt;&lt;br&gt; &lt;br&gt; &lt;span style="color:#008000"&gt;// iterate through all groupAccountLinks above - which would give applicationID and reviewID and GAL which has multiples&lt;/span&gt;&lt;br&gt; &lt;span style="color:#008000"&gt;//foreach (var galWithMulti in galMulti.Take(10000))&lt;/span&gt;&lt;br&gt; &lt;span style="color:#0000ff"&gt;foreach&lt;/span&gt;&lt;span style="color:#000000"&gt; (&lt;/span&gt;&lt;span style="color:#0000ff"&gt;var&lt;/span&gt;&lt;span style="color:#000000"&gt; galWithMulti &lt;/span&gt;&lt;span style="color:#0000ff"&gt;in&lt;/span&gt;&lt;span style="color:#000000"&gt; galMulti)&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;{&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;    &lt;/span&gt;&lt;span style="color:#0000ff"&gt;var&lt;/span&gt;&lt;span style="color:#000000"&gt; riAnon = &lt;/span&gt;&lt;span style="color:#0000ff"&gt;from&lt;/span&gt;&lt;span style="color:#000000"&gt; r &lt;/span&gt;&lt;span style="color:#0000ff"&gt;in&lt;/span&gt;&lt;span style="color:#000000"&gt; ReviewItems&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;         &lt;/span&gt;&lt;span style="color:#008000"&gt;//where r.GroupAccountID == 1452&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;        &lt;/span&gt;&lt;span style="color:#000000"&gt; &lt;/span&gt;&lt;span style="color:#0000ff"&gt;where&lt;/span&gt;&lt;span style="color:#000000"&gt; r.GroupAccountID == galWithMulti.GroupAccountID&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;         &amp;amp;&amp;amp; ( r.ReviewItemStatusID == &lt;/span&gt;&lt;span style="color:#c81efa"&gt;0&lt;/span&gt;&lt;span style="color:#000000"&gt; || r.ReviewItemStatusID == &lt;/span&gt;&lt;span style="color:#c81efa"&gt;5&lt;/span&gt;&lt;span style="color:#000000"&gt; )&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;         &lt;/span&gt;&lt;span style="color:#0000ff"&gt;group&lt;/span&gt;&lt;span style="color:#000000"&gt; r &lt;/span&gt;&lt;span style="color:#0000ff"&gt;by&lt;/span&gt;&lt;span style="color:#000000"&gt; r.ReviewID &lt;/span&gt;&lt;span style="color:#0000ff"&gt;into&lt;/span&gt;&lt;span style="color:#000000"&gt; g&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;         &lt;/span&gt;&lt;span style="color:#0000ff"&gt;select&lt;/span&gt;&lt;span style="color:#000000"&gt; &lt;/span&gt;&lt;span style="color:#0000ff"&gt;new&lt;/span&gt;&lt;span style="color:#000000"&gt; { ReviewID = g.Key, CountOfReviewItemsWhichHaveThisReviewID = g.Count() };&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;    &lt;/span&gt;&lt;span style="color:#0000ff"&gt;var&lt;/span&gt;&lt;span style="color:#000000"&gt; onlyReviewIDWhereMoreThan = riAnon.Where (x =&amp;gt; x.CountOfReviewItemsWhichHaveThisReviewID &amp;gt; &lt;/span&gt;&lt;span style="color:#c81efa"&gt;1&lt;/span&gt;&lt;span style="color:#000000"&gt; ).ToList();&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;    &lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;    &lt;/span&gt;&lt;span style="color:#008000"&gt;// add offending ReviewItemIDs to list&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;    &lt;/span&gt;&lt;span style="color:#0000ff"&gt;foreach&lt;/span&gt;&lt;span style="color:#000000"&gt; (&lt;/span&gt;&lt;span style="color:#0000ff"&gt;var&lt;/span&gt;&lt;span style="color:#000000"&gt; element &lt;/span&gt;&lt;span style="color:#0000ff"&gt;in&lt;/span&gt;&lt;span style="color:#000000"&gt; onlyReviewIDWhereMoreThan)&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;    {&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;        &lt;/span&gt;&lt;span style="color:#008000"&gt;//var message = &amp;quot;galID: &amp;quot; + galWithMulti.GroupAccountID.ToString() + element.ToString();&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;        &lt;/span&gt;&lt;span style="color:#008000"&gt;//list.Add(message);&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;        &lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;        &lt;/span&gt;&lt;span style="color:#008000"&gt;// have got reviewID and GroupAccountID&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;        &lt;/span&gt;&lt;span style="color:#0000ff"&gt;var&lt;/span&gt;&lt;span style="color:#000000"&gt; riToDelete = (&lt;/span&gt;&lt;span style="color:#0000ff"&gt;from&lt;/span&gt;&lt;span style="color:#000000"&gt; r &lt;/span&gt;&lt;span style="color:#0000ff"&gt;in&lt;/span&gt;&lt;span style="color:#000000"&gt; ReviewItems&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;                        &lt;/span&gt;&lt;span style="color:#0000ff"&gt;where&lt;/span&gt;&lt;span style="color:#000000"&gt; r.GroupAccountID == galWithMulti.GroupAccountID&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;                        &amp;amp;&amp;amp; r.ReviewID == element.ReviewID&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;                        &amp;amp;&amp;amp; r.ReviewItemStatusID == &lt;/span&gt;&lt;span style="color:#c81efa"&gt;0&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;                        &lt;/span&gt;&lt;span style="color:#0000ff"&gt;select&lt;/span&gt;&lt;span style="color:#000000"&gt; r).First();&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;        &lt;/span&gt;&lt;span style="color:#008000"&gt;//listOfRIToDelete.Add(riToDelete.ReviewItemID);&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;        &lt;/span&gt;&lt;span style="color:#000000"&gt;ReviewItems.DeleteObject(riToDelete);&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;        SaveChanges();&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;    }&lt;/span&gt;&lt;br&gt; &lt;span style="color:#000000"&gt;}&lt;/span&gt;&lt;br&gt; &lt;br&gt; &lt;span style="color:#008000"&gt;//list.Dump();&lt;/span&gt;&lt;br&gt; &lt;span style="color:#008000"&gt;//listOfRIToDelete.Dump();&lt;/span&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt;</Content>
      <Created>2013-04-09T08:59:03.0924645-04:00</Created>
      <Modified>2013-04-09T08:59:03.0924645-04:00</Modified>
      <EntryId>8a50c8a6-3f81-4b3c-99b7-236a29687b15</EntryId>
      <Description />
      <Title>Linq–Counting and Grouping</Title>
      <Categories>Linq</Categories>
      <Author>admin</Author>
      <IsPublic>true</IsPublic>
      <Syndicated>true</Syndicated>
      <ShowOnFrontPage>true</ShowOnFrontPage>
      <AllowComments>true</AllowComments>
      <Attachments />
      <Crossposts />
      <Latitude xsi:nil="true" />
      <Longitude xsi:nil="true" />
    </Entry>
  </Entries>
</DayEntry>